<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jira Incident Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-done { background-color: #defadb; color: #1f7a1f; }
        .status-inprogress { background-color: #deebff; color: #0747a6; }
        .status-todo { background-color: #f4f5f7; color: #42526e; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <header class="mb-10 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Live Incident Tracker</h1>
                <p class="text-gray-600">Syncs with Jira every 5 minutes</p>
            </div>
            <div id="last-updated" class="text-sm text-gray-400"></div>
        </header>

        <div id="incident-container" class="grid gap-4">
            <div class="text-center py-10 text-gray-500">Loading incidents...</div>
        </div>
    </div>

    <script>
        async function fetchIncidents() {
            try {
                // Fetch the JSON file generated by GitHub Actions
                const response = await fetch('./incidents.json');
                if (!response.ok) throw new Error('No data found');
                const issues = await response.json();
                
                const container = document.getElementById('incident-container');
                const timeLabel = document.getElementById('last-updated');
                
                container.innerHTML = ''; // Clear loading state
                timeLabel.innerText = `Last sync: ${new Date().toLocaleTimeString()}`;

                if (issues.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500">No active incidents found.</p>';
                    return;
                }

                issues.forEach(issue => {
                    const status = issue.fields.status.name.replace(/\s+/g, '').toLowerCase();
                    const card = document.createElement('div');
                    card.className = "bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex justify-between items-center";
                    
                    card.innerHTML = `
                        <div>
                            <span class="text-xs font-mono text-gray-400 uppercase tracking-widest">${issue.key}</span>
                            <h2 class="text-lg font-semibold text-gray-800">${issue.fields.summary}</h2>
                            <p class="text-sm text-gray-500 mt-1">Updated: ${new Date(issue.fields.updated).toLocaleString()}</p>
                        </div>
                        <div class="px-3 py-1 rounded-full text-xs font-bold uppercase status-${status}">
                            ${issue.fields.status.name}
                        </div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('incident-container').innerHTML = 
                    `<p class="text-red-500 text-center">Failed to load data. Make sure the GitHub Action has run at least once.</p>`;
            }
        }

        fetchIncidents();
    </script>
</body>
</html>
